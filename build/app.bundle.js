!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function n(e){return"unit"==e?{"fill-color":{type:"categorical",property:"category",default:"red",stops:[["nonpublic","#C4BFB3"],["escalator","#C7DADC"],["stairs","#C7DADC"],["elevator","#C7DADC"],["ramp","#C7DADC"],["restroom.unisex","#C7DADC"],["restroom.male","#C7DADC"],["restroom.female","#C7DADC"],["restroom","#C7DADC"],["parking","#C7DADC"],["checkin","#C7DADC"],["immigration","red"],["postsecurity","red"],["presecurity","green"],["walkway","#FEFEFE"],["room","#FEEED8"],["security","#EECECF"],["0-Vides","rgba(114,114,114,0.75)"],["privatelounge","#EECECF"]]},"fill-opacity":1,"fill-outline-color":"rgba(37,37,37,0.3)"}:"fixture"==e||"kiosk"==e?{"fill-extrusion-color":"#aaa","fill-extrusion-height":2,"fill-extrusion-base":0,"fill-extrusion-opacity":.4}:"amenity"==e?{"circle-color":"#11b4da","circle-radius":{stops:[[17,2],[22,1]]}}:"occupant"==e?{"circle-color":"#11b4da","circle-radius":{stops:[[17,4],[18,0]]}}:"section"==e?{"fill-color":{type:"categorical",property:"category",default:"red",stops:[["immigration","rgba(255,37,37,0.3)"],["security","rgba(255,37,37,0.3)"]]},"fill-outline-color":"rgba(255,37,37,1)"}:"level"==e?{"fill-color":"#aaa"}:"geofence"==e?{"fill-color":"rgba(0,0,0,0.3)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],0,1]}:"anchor"==e?{"circle-color":"#11b4da","circle-radius":{stops:[[17,4],[18,0]]}}:void 0}function o(e){return"fixture"==e?{"text-field":["get","en",["get","name"]],"text-font":["Roboto Regular","Arial Unicode MS Regular"],"text-offset":[0,.6],"text-anchor":"top"}:"amenity"==e?{"text-field":["get","category"],"text-font":["Roboto Regular","Arial Unicode MS Regular"],"text-size":{stops:[[19,5],[22,20]]}}:"occupant"==e?{"text-field":["get","en",["get","name"]],"text-font":["Roboto Regular","Arial Unicode MS Regular"],"text-size":{stops:[[16,5],[22,20]]}}:{"text-field":["get","category"],"text-font":["Roboto Regular","Arial Unicode MS Regular"],"text-offset":[0,.6],"text-anchor":"top"}}r.r(t),r.d(t,"level_uuids",(function(){return i})),r.d(t,"layers_array",(function(){return u})),r.d(t,"load_geojsons",(function(){return c})),r.d(t,"load_vectortiles",(function(){return s}));var i=[],u=["level","unit","anchor","fixture","kiosk","amenity","occupant","section"],a=function(e,t,r){e.addLayer({id:r,source:t,"source-layer":r,type:["fixture","kiosk"].includes(r)?"fill-extrusion":["amenity","anchor","occupant"].includes(r)?"circle":"fill",minzoom:["amenity"].includes(r)?19:["occupant"].includes(r)?16:10,paint:n(r)}),l.includes(r)&&(u.push("text_"+r),e.addLayer({id:"text_"+r,source:t,"source-layer":r,type:"symbol",minzoom:["amenity"].includes(r)?19:["occupant"].includes(r)?16:18,layout:o(r)}))},l=["amenity","anchor","fixture","occupant"],c=function(e,t){return new Promise((function(r,n){Promise.all(u.map((function(t){return fetch(e+t+".geojson").then((function(e){return e.json()}))}))).then((function(e){return function(e){var t=e.filter((function(e){return"unit"==e.name}))[0],r=e.filter((function(e){return"anchor"==e.name}))[0],n=1;return e.map((function(e){return e.features.map((function(e){return e.properties.id=e.id,e.id=n,n++,e}))})),e.filter((function(e){return"level"==e.name})).forEach((function(e){return e.features.forEach((function(e){return i.push({value:e.properties.id,text:e.properties})}))})),e.filter((function(e){return"amenity"==e.name}))[0].features.map((function(e){return t.features.filter((function(t){return e.properties.unit_ids.includes(t.id)})).map((function(t){return e.properties.level_id=t.properties.level_id,e}))})),e.filter((function(e){return"occupant"==e.name}))[0].features.map((function(e){var n=r.features.filter((function(t){return e.properties.anchor_id==t.properties.id}))[0],o=t.features.filter((function(e){return n.properties.unit_id==e.properties.id}))[0];return e.geometry=n.geometry,e.properties.level_id=o.properties.level_id,e})),e.filter((function(e){return"section"==e.name})).map((function(e){return e.features=e.features.filter((function(e){return["security","immigration"].includes(e.properties.category)})),e})),e.filter((function(e){return"anchor"!==e.name}))}(e).forEach((function(e){t.addSource(e.name,{type:"geojson",data:e}),a(t,e.name,e.name)})),r()}))}))},s=function(e,t){console.log("Loading mvt async");return t.addSource("imdf_mvt",{type:"vector",tiles:[e]}),new Promise((function(e,r){return e(u.forEach((function(e){a(t,"imdf_mvt",e)})))}))}},function(e,t,r){r(0),e.exports=r(2)},function(e,t,r){"use strict";r.r(t);var n=r(0);mapboxgl.accessToken="pk.eyJ1Ijoic2FuZGVybWVpamVyIiwiYSI6ImNrNjIwdDFpMjA2eTYza3Q2bGRibXlxNHIifQ.wiN3LYeCSfVswOH--fmrkA";var o=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/dark-v10",center:[4.7627,52.3097],zoom:16}),i=document.querySelector("#levels"),u=document.querySelector("#format");window.map=o;var a=function(e){if("geojson"==e){var t=0;n.level_uuids.map((function(e){var r=document.createElement("option");t==e.text.short_name.en&&(t=e.value),r.value=e.value,r.innerHTML=e.text.short_name.en,i.appendChild(r)})),l(t)}else{t=0;n.level_uuids.forEach((function(e){return n.level_uuids.pop(e)})),n.level_uuids.push({value:"a94a5b0f-c2e3-4752-b614-f0883a51be03",text:-10}),n.level_uuids.push({value:"4970e968-62a1-4303-994f-574363554935",text:0}),n.level_uuids.push({value:"429fc537-126f-4efe-950e-b2d844c7768b",text:10}),n.level_uuids.push({value:"02d40cff-3e1e-42ff-946b-773cd50d4d5a",text:20}),n.level_uuids.push({value:"90d277a4-41f8-4458-88e1-11c2c134d488",text:30}),n.level_uuids.map((function(e){var r=document.createElement("option");t==e.text&&(t=e.value),r.value=e.value,r.innerHTML=e.text,i.appendChild(r)})),l(t)}},l=function(e){e&&(i.value=e),i.dispatchEvent(new Event("change"))},c=null;o.on("load",(function(){o.getStyle().layers.forEach((function(e){("symbol"===e.type||e.id.includes("pedestrian"))&&o.removeLayer(e.id)})),u.onchange=function(e){return t=e.srcElement.value,console.log("Format Demo:","geojson"==t),n.layers_array.forEach((function(e){void 0!==o.getLayer(e)&&(console.log("removeing",e),o.removeLayer(e),e.includes("text_")||o.removeSource(e))})),void("geojson"==t?Object(n.load_geojsons)("http://localhost:3002/imdf/",o).then((function(e){return a(t)})):Object(n.load_vectortiles)("http://localhost:3002/imdf/{z}/{x}/{y}.mvt",o).then((function(e){return a(t)})));var t},u.dispatchEvent(new Event("change")),console.log("loaded!"),i.onchange=function(e){"all"!=e.srcElement.value?n.layers_array.filter((function(e){return"level"!=e&&"anchor"!=e})).forEach((function(t){return o.setFilter(t,["==","level_id",e.srcElement.value])})):n.layers_array.filter((function(e){return"level"!=e&&"anchor"!=e})).forEach((function(e){return o.setFilter(e,null)}))}})),o.on("click",(function(e){o.queryRenderedFeatures([e.point.x,e.point.y],{layers:n.layers_array.filter((function(e){return"level"!=e&&"anchor"!=e}))}).forEach((function(e){return console.log(e.properties)}))})),o.on("mousemove","geofence",(function(e){e.features.length>0&&(c&&o.setFeatureState({source:"geofence",id:c},{hover:!1}),c=e.features[0].id,o.setFeatureState({source:"geofence",id:c},{hover:!0}))})),o.on("mouseleave","geofence",(function(){c&&o.setFeatureState({source:"geofence",id:c},{hover:!1}),c=null}))}]);